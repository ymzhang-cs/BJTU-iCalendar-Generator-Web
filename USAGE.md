# 使用说明

## 快速开始

### 1. 启动服务

**Windows用户：**
```bash
# 双击运行
start.bat
```

**Linux/macOS用户：**
```bash
# 运行启动脚本
chmod +x start.sh
./start.sh
```

**手动启动：**
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

### 2. 访问应用

- **Web界面**: http://localhost:5000
- **CalDAV服务**: http://localhost:5232

## 使用流程

### 步骤1：获取课表HTML文件

1. 登录北京交通大学教务系统
2. 进入"我的课表"页面
3. 使用 `Ctrl + S` 保存页面
4. 选择保存格式为"网页，仅HTML (*.html;*.htm)"
5. 保存到本地

### 步骤2：上传并生成日历

1. 打开 http://localhost:5000
2. 拖拽HTML文件到上传区域，或点击选择文件
3. 等待系统解析课表信息
4. 选择下载方式：
   - **下载ICS文件**：直接下载日历文件
   - **创建CalDAV账户**：创建在线日历账户

### 步骤3：导入到日历应用

#### 方式一：下载ICS文件

**iOS设备：**
1. 将ICS文件发送到自己的邮箱
2. 在邮件应用中打开ICS文件
3. 点击"添加全部"
4. 选择要保存到的日历

**Android设备：**
1. 使用日历应用导入ICS文件
2. 选择导入到现有日历或创建新日历

**电脑端：**
- **Outlook**: 文件 → 打开和导出 → 导入/导出 → 导入iCalendar文件
- **Google Calendar**: 设置 → 导入和导出 → 导入

#### 方式二：使用CalDAV账户

**iOS设备：**
1. 设置 → 日历 → 账户 → 添加账户
2. 选择"其他" → "CalDAV账户"
3. 输入服务器地址、用户名和密码
4. 点击"下一步"完成设置

**Android设备：**
1. 打开日历应用
2. 添加账户 → CalDAV
3. 输入服务器信息
4. 保存设置

## 功能特性

### 智能解析
- 自动识别课程名称、时间、地点、教师信息
- 支持连续周、间断周、间隔周等多种周次格式
- 识别错峰上课时间（思源西楼、逸夫楼）

### 标准兼容
- 生成标准iCalendar格式文件
- 兼容所有主流日历应用
- 支持重复事件规则（RRULE）

### CalDAV同步
- 集成Radicale CalDAV服务器
- 支持多设备日历同步
- 自动创建用户账户

## 故障排除

### 常见问题

**Q: 上传文件后提示"解析失败"**
A: 请确认：
- 文件格式为HTML
- 文件来自教务系统课表页面
- 文件完整保存（未截断）

**Q: CalDAV连接失败**
A: 请检查：
- 服务器地址是否正确
- 网络连接是否正常
- 防火墙设置

**Q: 课程时间不正确**
A: 系统会自动识别错峰上课时间，如果仍有问题，请检查：
- 课程地点是否包含"思源西楼"或"逸夫教学楼"
- 学期开始日期是否正确

### 技术支持

如果遇到问题，请：
1. 查看服务日志：`docker-compose logs -f`
2. 检查文件格式是否符合要求
3. 提交Issue到GitHub仓库

## 高级配置

### 自定义学期开始日期

如果需要指定学期开始日期，可以修改代码中的默认设置：

```python
# 在calendar_generator.py中修改
def _get_default_semester_start(self):
    # 修改这里的日期
    return datetime(2025, 3, 3)  # 年, 月, 日
```

### 修改课程时间

可以在`calendar_generator.py`中修改`TIME_SLOTS`和`STAGGERED_TIME_SLOTS`来调整课程时间：

```python
TIME_SLOTS = {
    1: "08:00",  # 第1节课开始时间
    2: "10:10",  # 第2节课开始时间
    # ... 其他时间
}
```

### 添加新的错峰教学楼

在`STAGGERED_KEYWORD`列表中添加新的教学楼名称：

```python
STAGGERED_KEYWORD = ['思源西楼', '逸夫教学楼', '新教学楼']
```
